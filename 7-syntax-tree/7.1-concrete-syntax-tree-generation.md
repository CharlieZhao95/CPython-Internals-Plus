# 7.1 具象语法树生成器

具象语法树（CST）（有时被称为**解析树**），是一种有序的有根树结构，其表示在上下文无关文法中的代码。

词法分析器和解析器创建出 CST。你已经在 Python 语言和语法章节探索了解析器生成器。解析器生成器的输出是一张有限自动机（DFA）解析表，描述了上下文无关文法中的可能状态。

{% hint style="info" %}
**See Also**

Python 的原作者 Guido van Rossum 目前正在研究一种上下文有关文法替代 LL(1)文法，这个语法正被 CPython 使用。而另一个可选方案是解析表达文法（PEG）。

PEG 会作为 Python 3.9 的实验特性发布出来。
{% endhint %}

在第五章语法章节中，你已经探索了一些表达式类型，比如：`if_stmt` 和 `with_stmt` 。具象语法树将语法符号（如：`if_stmt`）作为分支，而单词和终端符号作为叶子节点。

比如：将算术表达式 “a + 1” 转换成具象语法树，如下图所示：

<figure><img src="../.gitbook/assets/图7.1.1 a+1的具象语法树.png" alt=""><figcaption></figcaption></figure>

算术运算符在这里用三个分支来表示：左分支、操作符和右分支。

解析器迭代来自输入流的单词符号并与语法中的可能状态和单词符号匹配来构建具象语法树。

在上面具象语法树中展示的所有符号在 `Grammar/Grammar` 文件中都已经被定义：

<figure><img src="../.gitbook/assets/图7.1.2 符号定义.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../.gitbook/assets/图7.1.3 符号定义2.png" alt=""><figcaption></figcaption></figure>

而单词符号在 `Grammar/Tokens` 文件中也已被定义：

<figure><img src="../.gitbook/assets/图7.1.4 单词符号定义.png" alt=""><figcaption></figcaption></figure>

`Name` 单词符号可以表示变量、函数、类或者是模块的名称。但 Python 的语法不支持 `NAME` 成为：

* 保留关键字之一，比如：`await` 和 `async` ；
* 数值或者其他文字类型；

比如，你尝试定义一个为 1 的函数，Python 会抛出一个语法错误：

<figure><img src="../.gitbook/assets/图7.1.5 语法错误.png" alt=""><figcaption></figcaption></figure>

`NUMBER` 是一种特殊的单词符号类型，可以表示 Python 许多数值之一。Python 有一个特殊的数值语法，包含：

* 八进制值，如：O020；
* 十六进制值，如：0x10；
* 二进制值，如：ob10000；
* 复数，如：10j；
* 浮点数，如：1.01；
* 下划线作为逗号，如：1\_000\_000。

你可以通过 Python 中的 `symbol` 和 `token` 模块看到编译的符号和单词。

<figure><img src="../.gitbook/assets/图7.1.6 在Python中使用symbol和token.png" alt=""><figcaption></figcaption></figure>
